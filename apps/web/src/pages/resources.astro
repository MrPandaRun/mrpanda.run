---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { resourceTypeOrder } from "@/data/site";
import { getSortedResources } from "@/lib/content";
import { formatDate } from "@/lib/date";

const resources = await getSortedResources();

const typeLabel: Record<(typeof resourceTypeOrder)[number], string> = {
  "tool-stack": "Tool Stack",
  "prompt-template": "Prompt Templates",
  checklist: "Checklists",
  "learning-reference": "Learning References"
};

const delayClass = ["delay-1", "delay-2", "delay-3"] as const;
---

<BaseLayout title="Resources" description="Tool stack, prompt templates, checklists, and references with copy/download actions.">
  <div class="page-shell space-y-8 py-10 md:py-14">
    <section class="max-w-4xl fade-rise">
      <p class="section-kicker">Resource Library</p>
      <h1 class="page-title mt-4">Resource Library</h1>
      <p class="mt-4 text-sm leading-7 text-ink/72">
        Practical tools and templates I actually use. Focused on execution and reuse.
      </p>
    </section>

    {resourceTypeOrder.map((type, index) => {
      const list = resources.filter((item) => item.data.type === type);
      const sectionDelay = delayClass[Math.min(index, 2)];

      return (
        <section class={`fade-rise ${sectionDelay}`}>
          <h2 class="font-display text-3xl text-ink">{typeLabel[type]}</h2>
          <div class="mt-4 grid gap-4 md:grid-cols-2">
            {list.map((resource) => {
              const isExternal = resource.data.link.startsWith("http");
              const isDownload = resource.data.link.startsWith("/downloads/");

              return (
                <article class="rounded-2xl border border-line/80 bg-paper/95 p-5 shadow-card">
                  <h3 class="text-xl font-semibold text-ink">{resource.data.title}</h3>
                  <p class="mt-2 text-sm leading-7 text-ink/70">{resource.data.description}</p>
                  <p class="mt-3 text-xs uppercase tracking-[0.14em] text-ink/45">
                    Updated {formatDate(resource.data.updatedAt)}
                  </p>
                  <div class="mt-4 flex flex-col gap-2 text-sm sm:flex-row sm:flex-wrap">
                    <a
                      href={resource.data.link}
                      target={isExternal ? "_blank" : undefined}
                      rel={isExternal ? "noreferrer" : undefined}
                      download={isDownload ? resource.data.downloadName : undefined}
                      class="inline-flex w-full items-center justify-center rounded-full border border-line bg-paper px-3 py-1.5 text-ink/70 transition hover:-translate-y-0.5 hover:text-ink sm:w-auto"
                    >
                      {isDownload ? "Download" : "Open"}
                    </a>

                    <button
                      type="button"
                      data-resource-copy
                      data-resource-link={resource.data.link}
                      data-resource-title={resource.data.title}
                      data-resource-type={resource.data.type}
                      class="inline-flex w-full items-center justify-center rounded-full border border-line bg-paper px-3 py-1.5 text-ink/70 transition hover:-translate-y-0.5 hover:text-ink sm:w-auto"
                    >
                      <span data-copy-label>Copy</span>
                    </button>
                  </div>
                </article>
              );
            })}
          </div>
        </section>
      );
    })}
  </div>
</BaseLayout>
