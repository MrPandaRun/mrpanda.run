---
import BrandAvatar from "@/components/BrandAvatar.astro";
import { mainNav } from "@/data/site";

const pathname = Astro.url.pathname;

function isActive(href: string): boolean {
  if (href === "/") {
    return pathname === "/";
  }

  return pathname === href || pathname.startsWith(`${href}/`);
}
---

<header class="sticky top-0 z-40 border-b border-line/80 bg-paper/90 backdrop-blur">
  <div class="mx-auto max-w-6xl px-4 py-3 md:px-6">
    <div class="flex items-center justify-between gap-3">
      <a href="/" class="shrink-0 font-display text-sm font-semibold tracking-[0.08em] text-ink">
        <span class="flex items-center gap-2">
          <BrandAvatar
            size="sm"
            shape="round"
            loading="eager"
            alt="Mr Panda avatar"
            className="ring-1 ring-accent/35"
          />
          <span>[ mrpanda.run ]</span>
        </span>
      </a>

      <details class="group relative md:hidden">
        <summary class="list-none cursor-pointer rounded-full border border-line/90 bg-paper px-3 py-1.5 font-mono text-[11px] uppercase tracking-[0.12em] text-ink/75 transition hover:border-accent/45 hover:text-ink [&::-webkit-details-marker]:hidden">
          Menu
        </summary>
        <nav
          aria-label="Mobile navigation"
          class="absolute right-0 z-50 mt-2 w-56 rounded-2xl border border-line/90 bg-paper/95 p-2 shadow-card"
        >
          {mainNav.map((item) => {
            const active = isActive(item.href);

            return (
              <a
                href={item.href}
                aria-current={active ? "page" : undefined}
                class={`mb-1 block rounded-xl border px-3 py-2 font-mono text-[11px] uppercase tracking-[0.12em] transition last:mb-0 ${
                  active
                    ? "border-accent/80 bg-accent/10 text-ink"
                    : "border-line/90 bg-paper text-ink/70 hover:border-accent/45 hover:text-ink"
                }`}
              >
                {item.label}
              </a>
            );
          })}
        </nav>
      </details>
    </div>

    <div class="mt-3 hidden items-center gap-4 md:flex">
      <div class="hidden items-center gap-2 text-[11px] uppercase tracking-[0.16em] text-ink/55 md:flex">
        <span class="inline-block h-2 w-2 rounded-full bg-mint"></span>
        <span>Live Build Log</span>
      </div>

      <nav
        aria-label="Main navigation"
        class="flex min-w-0 flex-1 items-center justify-end gap-2 overflow-x-auto pb-1 [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden md:pb-0"
      >
        {mainNav.map((item) => {
          const active = isActive(item.href);

          return (
            <a
              href={item.href}
              aria-current={active ? "page" : undefined}
              class={`whitespace-nowrap border px-3 py-1.5 font-mono text-[11px] uppercase tracking-[0.12em] transition ${
                active
                  ? "border-accent/80 bg-accent/10 text-ink"
                  : "border-line/90 bg-paper text-ink/70 hover:border-accent/45 hover:text-ink"
              }`}
            >
              {item.label}
            </a>
          );
        })}
      </nav>
    </div>
  </div>
</header>
